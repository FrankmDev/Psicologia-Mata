---
interface Props {
  activePage?: string;
}

const { activePage = "" } = Astro.props;

const navLinks = [
  { href: "/", label: "Inicio" },
  { href: "/services", label: "Servicios" },
  { href: "/blog", label: "Blog" },
  { href: "/contact", label: "Contacto" },
];
---

<header
  class="fixed top-0 inset-x-0 z-50 transition-all duration-[600ms] ease-out"
  id="header"
>
  <div
    class="absolute inset-0 bg-alabaster/0 backdrop-blur-0 transition-all duration-[600ms] ease-out border-b border-transparent"
    id="header-bg"
  >
  </div>

  <div class="container-editorial relative">
    <div class="flex items-center justify-between h-20 lg:h-28">
      
      <!-- Logo Minimalista -->
      <a href="/" class="flex items-center gap-4 group relative z-50 transition-transform duration-300 hover:scale-[1.02]">
        <div class="hidden sm:flex flex-col justify-center items-start">
          <span class="font-serif text-[1.35rem] leading-none text-ink tracking-tight group-hover:text-olive transition-colors duration-500">María Ángeles Mata</span>
          <span class="text-label-xs text-taupe tracking-[0.3em] mt-1.5 group-hover:text-olive/70 transition-colors duration-500">Psicología Clínica</span>
        </div>
        <!-- Logo Mobile -->
        <span class="sm:hidden font-serif text-2xl text-ink italic">M.A. Mata</span>
      </a>

      <!-- Desktop Nav -->
      <nav class="hidden lg:flex items-center gap-12 relative z-50">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class={`relative text-label tracking-[0.15em] transition-colors duration-500 overflow-hidden group ${
              activePage === link.label
                ? "text-ink font-semibold"
                : "text-taupe hover:text-ink"
            }`}
          >
            <span class="relative z-10">{link.label}</span>
            <span class="absolute bottom-0 left-0 w-full h-[1px] bg-ink transform origin-right scale-x-0 transition-transform duration-500 ease-out group-hover:scale-x-100 group-hover:origin-left"></span>
          </a>
        ))}
      </nav>

      <!-- CTA -->
      <div class="hidden lg:flex items-center gap-8 relative z-50">
        <a
          href="tel:+34661471971"
          class="text-taupe hover:text-olive transition-all duration-500 flex items-center gap-2 group hover:gap-3"
        >
          <span class="w-1.5 h-1.5 rounded-full bg-olive/50 group-hover:bg-olive group-hover:scale-125 transition-all duration-500"></span>
          <span class="text-label tracking-[0.1em]">661 471 971</span>
        </a>
        <a href="/contact" class="btn btn-sage py-3.5 px-8 !text-[0.6875rem] shadow-lg shadow-olive/0 hover:shadow-olive/20 transition-shadow duration-500">
          Reservar Sesión
        </a>
      </div>

      <!-- Mobile Toggle -->
      <button
        class="lg:hidden relative z-50 w-10 h-10 flex items-center justify-center text-ink hover:text-olive transition-colors"
        id="menu-toggle"
        aria-label="Menu"
      >
        <div class="flex flex-col gap-1.5 w-6">
          <span class="w-6 h-[1px] bg-current transition-all origin-center duration-500 ease-out" id="menu-line-1"></span>
          <span class="w-6 h-[1px] bg-current transition-all origin-center duration-500 ease-out" id="menu-line-2"></span>
        </div>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    class="lg:hidden fixed inset-0 bg-alabaster z-40 opacity-0 pointer-events-none transition-all duration-700 ease-out"
    id="mobile-menu"
  >
    <div class="absolute inset-0 bg-aurora opacity-30"></div>
    <div class="container-editorial relative pt-32 h-full flex flex-col justify-between pb-12 z-10">
      
      <nav class="flex flex-col gap-6">
        {navLinks.map((link, index) => (
          <a
            href={link.href}
            class="mobile-link opacity-0 translate-y-4 font-serif text-5xl text-ink hover:text-olive transition-all duration-500 italic font-light"
            style={`transition-delay: ${index * 100}ms`}
          >
            {link.label}
          </a>
        ))}
      </nav>
      
      <div class="mt-8 pt-8 border-t border-border-delicate mobile-footer opacity-0 translate-y-4 transition-all duration-700 delay-300">
        <p class="text-label-sm text-taupe mb-4">
          Contacto Directo
        </p>
        <a href="tel:+34661471971" class="block font-serif text-3xl text-ink mb-8">
          661 471 971
        </a>
        <a href="/contact" class="btn btn-sage w-full justify-center py-4">
          Reservar Consulta
        </a>
      </div>
    </div>
  </div>
</header>

<div class="h-20 lg:h-28"></div>

<script>
  const header = document.getElementById("header");
  const headerBg = document.getElementById("header-bg");
  const menuToggle = document.getElementById("menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const line1 = document.getElementById("menu-line-1");
  const line2 = document.getElementById("menu-line-2");
  const mobileLinks = document.querySelectorAll(".mobile-link");
  const mobileFooter = document.querySelector(".mobile-footer");
  
  let menuOpen = false;
  let lastScroll = 0;

  window.addEventListener(
    "scroll",
    () => {
      const currentScroll = window.scrollY;
      
      // Header background
      if (currentScroll > 20) {
        headerBg?.classList.add("bg-alabaster/95", "backdrop-blur-xl", "border-border-delicate");
        headerBg?.classList.remove("border-transparent");
      } else {
        headerBg?.classList.remove("bg-alabaster/95", "backdrop-blur-xl", "border-border-delicate");
        headerBg?.classList.add("border-transparent");
      }

      // Hide header on scroll down, show on scroll up
      if (currentScroll > 100 && currentScroll > lastScroll && !menuOpen) {
        header?.classList.add("-translate-y-full");
      } else {
        header?.classList.remove("-translate-y-full");
      }
      
      lastScroll = currentScroll;
    },
    { passive: true }
  );

  menuToggle?.addEventListener("click", () => {
    menuOpen = !menuOpen;
    
    if (menuOpen) {
      // Open
      mobileMenu?.classList.remove("opacity-0", "pointer-events-none");
      document.body.style.overflow = "hidden";
      
      line1 && (line1.style.transform = "translateY(3.5px) rotate(45deg)");
      line2 && (line2.style.transform = "translateY(-3.5px) rotate(-45deg)");
      
      // Animate links in
      setTimeout(() => {
        mobileLinks.forEach(link => {
          link.classList.remove("opacity-0", "translate-y-4");
        });
        mobileFooter?.classList.remove("opacity-0", "translate-y-4");
      }, 100);

    } else {
      // Close
      mobileMenu?.classList.add("opacity-0", "pointer-events-none");
      document.body.style.overflow = "";
      
      line1 && (line1.style.transform = "none");
      line2 && (line2.style.transform = "none");
      
      // Reset links
      mobileLinks.forEach(link => {
        link.classList.add("opacity-0", "translate-y-4");
      });
      mobileFooter?.classList.add("opacity-0", "translate-y-4");
    }
  });
</script>
