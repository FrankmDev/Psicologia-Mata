---
interface Props {
  activePage?: string;
}

const { activePage = "" } = Astro.props;

const navLinks = [
  { href: "/", label: "Inicio" },
  { href: "/services", label: "Servicios" },
  { href: "/blog", label: "Blog" },
  { href: "/contact", label: "Contacto" },
];
---

<header class="fixed top-0 inset-x-0 z-50 transition-all duration-500" id="header">
  <div class="absolute inset-0 bg-bg-base/80 backdrop-blur-xl border-b border-border-light/50" id="header-bg"></div>

  <div class="container-elegant relative">
    <div class="flex items-center justify-between h-16 lg:h-20">
      <a href="/" class="flex items-center gap-3 group" aria-label="María Ángeles Mata - Inicio">
        <div class="w-9 h-9 lg:w-10 lg:h-10 rounded-full bg-sage/10 flex items-center justify-center transition-all duration-300 group-hover:bg-sage group-hover:scale-105">
          <span class="font-serif text-base lg:text-lg text-sage group-hover:text-white italic transition-colors">M</span>
        </div>
        <div class="hidden sm:block">
          <span class="font-serif text-sm lg:text-base text-text-primary tracking-tight block leading-tight">María Ángeles Mata</span>
          <span class="text-[10px] lg:text-xs text-text-secondary tracking-wide">Psicóloga Clínica</span>
        </div>
      </a>

      <nav class="hidden lg:flex items-center" aria-label="Navegación principal">
        <div class="flex items-center gap-1 bg-bg-muted/50 rounded-full p-1 border border-border-light/50">
          {navLinks.map((link) => (
            <a
              href={link.href}
              class={`px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 ${
                activePage === link.label 
                  ? "bg-bg-surface text-text-primary shadow-sm" 
                  : "text-text-secondary hover:text-text-primary hover:bg-bg-surface/50"
              }`}
              aria-current={activePage === link.label ? "page" : undefined}
            >
              {link.label}
            </a>
          ))}
        </div>
      </nav>

      <div class="hidden lg:block">
        <a href="/contact" class="btn btn-primary btn-sm">
          <span>Reservar cita</span>
          <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.25 8.75L21 12m0 0l-3.75 3.25M21 12H3" />
          </svg>
        </a>
      </div>

      <button
        class="lg:hidden relative z-50 p-2 text-text-primary flex items-center justify-center w-10 h-10 rounded-full hover:bg-bg-muted transition-colors"
        aria-label="Abrir menú"
        aria-expanded="false"
        id="menu-toggle"
      >
        <div class="flex flex-col justify-center items-center gap-1.5 w-5 h-5">
          <span class="w-5 h-0.5 bg-current transition-all duration-300 origin-center block" id="menu-line-1"></span>
          <span class="w-5 h-0.5 bg-current transition-all duration-300 origin-center block" id="menu-line-2"></span>
        </div>
      </button>
    </div>
  </div>

  <div
    class="lg:hidden fixed inset-0 bg-bg-base/98 backdrop-blur-2xl z-40 opacity-0 pointer-events-none transition-all duration-500"
    id="mobile-menu"
    role="dialog"
    aria-modal="true"
    aria-label="Menú de navegación"
  >
    <div class="flex flex-col h-full pt-24 pb-8 container-elegant">
      <nav class="flex flex-col gap-2 mt-8" aria-label="Navegación móvil">
        {navLinks.map((link, index) => (
          <a
            href={link.href}
            class={`px-4 py-3 rounded-xl text-lg font-medium transition-all duration-300 ${
              activePage === link.label
                ? "bg-sage/10 text-sage"
                : "text-text-primary hover:bg-bg-muted"
            }`}
            style={`animation-delay: ${index * 0.05}s`}
            aria-current={activePage === link.label ? "page" : undefined}
          >
            {link.label}
          </a>
        ))}
      </nav>

      <div class="mt-auto flex flex-col gap-4">
        <a href="/contact" class="btn btn-primary btn-full">
          <span>Reservar cita</span>
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.25 8.75L21 12m0 0l-3.75 3.25M21 12H3" />
          </svg>
        </a>
        <a href="tel:+34661471971" class="text-center text-text-secondary hover:text-text-primary transition-colors text-sm py-2">
          Llamar: 661 471 971
        </a>
      </div>
    </div>
  </div>
</header>

<div class="h-16 lg:h-20" aria-hidden="true"></div>

<script>
  const header = document.getElementById("header");
  const headerBg = document.getElementById("header-bg");
  const menuToggle = document.getElementById("menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const line1 = document.getElementById("menu-line-1");
  const line2 = document.getElementById("menu-line-2");
  let menuOpen = false;

  window.addEventListener("scroll", () => {
    if (window.scrollY > 10) {
      headerBg?.classList.add("shadow-sm");
      headerBg?.classList.replace("bg-bg-base/80", "bg-bg-base/95");
    } else {
      headerBg?.classList.remove("shadow-sm");
      headerBg?.classList.replace("bg-bg-base/95", "bg-bg-base/80");
    }
  }, { passive: true });

  function toggleMenu() {
    menuOpen = !menuOpen;
    if (menuOpen) {
      mobileMenu?.classList.remove("opacity-0", "pointer-events-none");
      document.body.style.overflow = "hidden";
      menuToggle?.setAttribute("aria-expanded", "true");
      if (line1 && line2) {
        line1.style.transform = "translateY(4px) rotate(45deg)";
        line2.style.transform = "translateY(-4px) rotate(-45deg)";
      }
    } else {
      mobileMenu?.classList.add("opacity-0", "pointer-events-none");
      document.body.style.overflow = "";
      menuToggle?.setAttribute("aria-expanded", "false");
      if (line1 && line2) {
        line1.style.transform = "none";
        line2.style.transform = "none";
      }
    }
  }

  menuToggle?.addEventListener("click", toggleMenu);
  mobileMenu?.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => { if (menuOpen) toggleMenu(); });
  });

  // Close on escape
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && menuOpen) toggleMenu();
  });
</script>
