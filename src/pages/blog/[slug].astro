---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import Schema from '../../components/Schema.astro';
import { blogPosts, getPostBySlug } from '../../data/blog';

export function getStaticPaths() {
  return Object.keys(blogPosts).map(slug => ({ params: { slug } }));
}

const { slug } = Astro.params;
const post = getPostBySlug(slug as string);

if (!post) {
  return Astro.redirect('/404');
}

const title = `${post.title} | María Ángeles Mata`;
const canonicalUrl = `https://psicologia-mata.es/blog/${slug}`;

// Convert date format from "15 Enero 2025" to ISO format
function parseDate(dateStr: string): string {
  const months: Record<string, string> = {
    'Enero': '01', 'Febrero': '02', 'Marzo': '03', 'Abril': '04',
    'Mayo': '05', 'Junio': '06', 'Julio': '07', 'Agosto': '08',
    'Septiembre': '09', 'Octubre': '10', 'Noviembre': '11', 'Diciembre': '12'
  };
  const parts = dateStr.split(' ');
  if (parts.length === 3) {
    const day = parts[0].padStart(2, '0');
    const month = months[parts[1]] || '01';
    const year = parts[2];
    return `${year}-${month}-${day}`;
  }
  return new Date().toISOString().split('T')[0];
}

const datePublished = parseDate(post.date);

const articleData = {
  headline: post.title,
  description: post.excerpt,
  image: post.image,
  datePublished: datePublished,
  dateModified: datePublished,
  author: {
    name: "María Ángeles Mata",
    url: "https://psicologia-mata.es"
  },
  publisher: {
    name: "María Ángeles Mata - Psicóloga",
    logo: "https://psicologia-mata.es/favicon.svg"
  },
  url: canonicalUrl
};

const breadcrumbData = [
  { name: "Inicio", url: "https://psicologia-mata.es/" },
  { name: "Blog", url: "https://psicologia-mata.es/blog" },
  { name: post.title, url: canonicalUrl }
];
---

<Layout 
  title={title} 
  description={post.excerpt}
  type="article"
  image={post.image}
  canonical={`/blog/${slug}`}
  publishedTime={datePublished}
>
  <Schema slot="schema" type="article" data={articleData} />
  <Schema slot="schema" type="breadcrumbs" data={breadcrumbData} />
  
  <Header activePage="Blog" />
  
  <main id="main-content">
    
    <!-- Header del artículo -->
    <section class="section bg-charcoal text-alabaster relative overflow-hidden" aria-labelledby="article-heading">
      
      <!-- Elemento de fondo decorativo -->
      <div class="absolute -top-1/2 -right-1/4 w-[80vw] h-[80vw] rounded-full bg-ink blur-[120px] opacity-50 pointer-events-none"></div>

      <div class="container-editorial relative z-10">
        
        <!-- Breadcrumbs -->
        <nav class="mb-10" aria-label="Migas de pan">
          <ol class="flex items-center gap-3 text-xs text-alabaster/40">
            <li><a href="/" class="hover:text-alabaster transition-colors duration-300">Inicio</a></li>
            <li class="text-alabaster/20">/</li>
            <li><a href="/blog" class="hover:text-alabaster transition-colors duration-300">Blog</a></li>
            <li class="text-alabaster/20">/</li>
            <li class="text-alabaster/70">{post.category}</li>
          </ol>
        </nav>
        
        <div class="max-w-4xl" data-reveal>
          <div class="flex items-center gap-4 mb-8">
            <span class="font-sans text-xs text-terracotta-light uppercase tracking-[0.2em] font-medium">{post.category}</span>
            <span class="w-8 h-[1px] bg-alabaster/20"></span>
            <span class="font-sans text-[0.6875rem] text-alabaster/50 uppercase tracking-[0.1em]">{post.date} · {post.readTime}</span>
          </div>
          
          <h1 id="article-heading" class="font-serif text-[clamp(2.5rem,5vw,4.5rem)] text-alabaster leading-[1.05] mb-8">
            {post.title}
          </h1>
          
          <p class="font-sans text-[1.0625rem] text-taupe-light font-light leading-relaxed max-w-2xl">
            {post.excerpt}
          </p>
        </div>
      </div>
    </section>
    
    <!-- Imagen destacada -->
    <div class="relative -mt-20 mx-4 lg:mx-auto max-w-5xl" data-reveal>
      <div class="aspect-[21/9] rounded-xl overflow-hidden shadow-2xl shadow-ink/10">
        <img 
          src={post.image} 
          alt={post.title} 
          class="w-full h-full object-cover"
          width="1200"
          height="514"
          loading="eager"
        />
      </div>
    </div>
    
    <!-- Contenido -->
    <section class="section bg-alabaster">
      <div class="max-w-3xl mx-auto px-5">
        
        <div 
          class="prose prose-lg max-w-none
            prose-headings:font-serif prose-headings:text-ink prose-headings:font-normal
            prose-h2:text-xl prose-h2:mt-12 prose-h2:mb-5 prose-h2:leading-tight
            prose-h3:text-lg prose-h3:mt-8 prose-h3:mb-4 prose-h3:leading-snug
            prose-p:text-taupe prose-p:leading-[1.8] prose-p:mb-6 prose-p:text-[1.0625rem]
            prose-a:text-olive prose-a:no-underline hover:prose-a:underline
            prose-strong:text-ink prose-strong:font-medium
            prose-ul:my-8 prose-ul:space-y-3
            prose-li:text-taupe prose-li:marker:text-olive prose-li:text-[1.0625rem]
            prose-blockquote:border-l-2 prose-blockquote:border-olive prose-blockquote:bg-cream prose-blockquote:py-6 prose-blockquote:px-8 prose-blockquote:rounded-r-lg prose-blockquote:my-10 prose-blockquote:not-italic
            prose-img:rounded-lg prose-img:shadow-lg prose-img:my-8"
          set:html={post.content}
        />
        
        <!-- Autor -->
        <footer class="mt-16 pt-10 border-t border-border-strong">
          <div class="flex items-center gap-6">
            <div class="w-16 h-16 rounded-full bg-olive/10 flex items-center justify-center shrink-0">
              <span class="font-serif text-2xl text-olive">M</span>
            </div>
            <div>
              <p class="font-serif text-xl text-ink mb-1">María Ángeles Mata</p>
              <p class="font-sans text-sm text-taupe">Psicóloga General Sanitaria · Colegiada nº AN-01452</p>
            </div>
          </div>
        </footer>
        
        <!-- Navegación inferior -->
        <div class="mt-12 pt-8 border-t border-border-delicate flex flex-col sm:flex-row items-center justify-between gap-6">
          <a href="/contact" class="btn btn-sage">Reservar consulta</a>
          <a href="/blog" class="group flex items-center gap-3 text-ink hover:text-olive transition-colors duration-300">
            <svg class="w-4 h-4 transform group-hover:-translate-x-1 transition-transform rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 8.75L21 12m0 0l-3.75 3.25M21 12H3" />
            </svg>
            <span class="font-sans text-xs uppercase tracking-[0.2em] font-medium">Más artículos</span>
          </a>
        </div>
        
      </div>
    </section>
    
    <!-- CTA relacionado -->
    <section class="section bg-cream">
      <div class="container-editorial">
        <div class="max-w-4xl mx-auto text-center" data-reveal>
          <div class="mb-8">
            <span class="label-section">¿Te ha interesado?</span>
          </div>
          <h2 class="title-section mb-8">
            La terapia puede <em class="text-olive italic">ayudarte</em>
          </h2>
          <p class="font-sans text-[1.0625rem] text-taupe font-light max-w-2xl mx-auto mb-10">
            Si este contenido resuena contigo, quizás es el momento de dar el siguiente paso. Estoy aquí para acompañarte.
          </p>
          <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
            <a href="/contact" class="btn btn-sage">Solicitar información</a>
            <a href="tel:+34661471971" class="btn btn-outline">
              <span class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
                </svg>
                661 471 971
              </span>
            </a>
          </div>
        </div>
      </div>
    </section>
    
  </main>
  
  <Footer />
</Layout>
