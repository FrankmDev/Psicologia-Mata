---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { blogPosts, getPostBySlug } from '../../data/blog';

export function getStaticPaths() {
  return Object.keys(blogPosts).map(slug => ({ params: { slug } }));
}

const { slug } = Astro.params;
const post = getPostBySlug(slug as string);

if (!post) {
  return Astro.redirect('/404');
}

const title = `${post.title} | María Ángeles Mata`;
---

<Layout title={title} description={post.excerpt} image={post.image} type="article">
  <Header activePage="Blog" />
  
  <main id="main-content">
    <article>
      <header class="section-sm bg-charcoal relative overflow-hidden">
        <div class="absolute inset-0 bg-grain opacity-[0.02]" aria-hidden="true"></div>
        <div class="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-sage/5 to-transparent" aria-hidden="true"></div>
        
        <div class="container-elegant relative">
          <nav class="mb-5" aria-label="Migas de pan">
            <ol class="flex items-center gap-2 text-sm text-sage/60">
              <li><a href="/" class="hover:text-sage transition-colors">Inicio</a></li>
              <li class="text-sage/30" aria-hidden="true">/</li>
              <li><a href="/blog" class="hover:text-sage transition-colors">Blog</a></li>
              <li class="text-sage/30" aria-hidden="true">/</li>
              <li class="text-sage/80" aria-current="page">{post.category}</li>
            </ol>
          </nav>
          
          <div class="flex items-center gap-3 mb-4">
            <span class="text-caption text-sage/70 px-3 py-1 bg-sage/10 rounded-full">{post.category}</span>
            <span class="text-xs text-mist/40">{post.date}</span>
            <span class="text-xs text-mist/40">· {post.readTime}</span>
          </div>
          
          <h1 class="text-headline text-ivory mb-5 max-w-3xl leading-tight">{post.title}</h1>
          <p class="text-body-lg text-mist/50 max-w-2xl">{post.excerpt}</p>
        </div>
      </header>
      
      <div class="relative -mt-8 mx-4 lg:mx-auto max-w-5xl">
        <div class="aspect-[21/9] overflow-hidden rounded-2xl shadow-2xl">
          <img 
            src={post.image} 
            alt={post.title} 
            class="w-full h-full object-cover"
            width="1200"
            height="514"
            loading="eager"
          />
        </div>
      </div>
      
      <div class="section bg-ivory">
        <div class="max-w-2xl mx-auto px-6 lg:px-8">
          <div 
            class="prose prose-lg prose-slate max-w-none
              prose-headings:font-serif prose-headings:text-charcoal prose-headings:font-normal
              prose-h2:text-2xl prose-h2:mt-16 prose-h2:mb-5 prose-h2:leading-tight
              prose-h3:text-xl prose-h3:mt-10 prose-h3:mb-4 prose-h3:leading-snug
              prose-p:text-stone/80 prose-p:leading-[1.8] prose-p:mb-6 prose-p:text-[15px]
              prose-a:text-sage prose-a:no-underline hover:prose-a:underline prose-a:font-medium
              prose-strong:text-charcoal prose-strong:font-medium
              prose-ul:my-8 prose-ul:space-y-3
              prose-li:text-stone/80 prose-li:marker:text-sage
              prose-blockquote:border-l-4 prose-blockquote:border-sage prose-blockquote:bg-sage/5 prose-blockquote:py-5 prose-blockquote:px-6 prose-blockquote:rounded-r-xl prose-blockquote:my-12 prose-blockquote:not-italic
              prose-figure:my-14 prose-figcaption:text-sm prose-figcaption:text-stone/50 prose-figcaption:text-center prose-figcaption:mt-4
              prose-img:rounded-2xl prose-img:shadow-lg prose-img:my-10"
            set:html={post.content}
          />
          
          <footer class="mt-16 pt-10 border-t border-border-light">
            <div class="card p-6 flex flex-col sm:flex-row items-center sm:items-start gap-5">
              <div class="w-14 h-14 rounded-full bg-sage/10 flex items-center justify-center shrink-0">
                <span class="font-serif text-xl text-sage">M</span>
              </div>
              <div class="text-center sm:text-left">
                <p class="font-serif text-lg text-charcoal mb-1">María Ángeles Mata</p>
                <p class="text-sm text-stone/60 mb-2">Psicóloga General Sanitaria · Colegiada nº AN-01452</p>
                <p class="text-sm text-stone/70 leading-relaxed">Especialista en terapia individual, de pareja y familiar. 15+ años de experiencia.</p>
              </div>
            </div>
          </footer>
          
          <div class="mt-10 pt-8 border-t border-border-light">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6">
              <div>
                <p class="text-sm text-stone/50 mb-3">¿Te ha resultado útil?</p>
                <a href="/contact" class="btn btn-primary btn-sm">Reservar consulta</a>
              </div>
              <a href="/blog" class="text-sm font-medium text-sage hover:text-sage-dark flex items-center gap-2">
                <svg class="w-4 h-4 rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.25 8.75L21 12m0 0l-3.75 3.25M21 12H3" />
                </svg>
                <span>Más artículos</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </article>
  </main>
  
  <Footer />
</Layout>
